<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Ultimate MP4 → MP3 Converter (Free)</title>
<style>
*{box-sizing:border-box;}
body{
  margin:0;
  font-family:Arial,sans-serif;
  background: linear-gradient(270deg,#0f2027,#203a43,#2c5364);
  background-size:400% 400%;
  animation:bgMove 12s ease infinite;
  display:flex;
  justify-content:center;
  align-items:flex-start;
  padding-top:30px;
  color:white;
  min-height:100vh;
}
@keyframes bgMove{0%{background-position:0% 50%}50%{background-position:100% 50%}100%{background-position:0% 50%}}
#app{
  background: rgba(0,0,0,0.6);
  backdrop-filter: blur(10px);
  padding: 20px 30px;
  border-radius: 20px;
  width: 500px;
  max-height:90vh;
  overflow-y:auto;
  box-shadow:0 0 50px rgba(0,255,255,0.5);
  position:relative;
  z-index:1;
}
h1{text-align:center;margin-bottom:20px;text-shadow:0 0 15px cyan;}
#drop{
  border:2px dashed cyan;
  border-radius:15px;
  padding:40px;
  text-align:center;
  cursor:pointer;
  transition:.3s;
  margin-bottom:15px;
  position:relative;
  z-index:2;
}
#drop:hover{background:rgba(0,255,255,0.1);transform:scale(1.05);}
.file-card{
  background:#111;
  padding:10px;
  margin:10px 0;
  border-radius:10px;
  display:flex;
  align-items:center;
  justify-content:space-between;
  animation:floatCard 3s ease-in-out infinite;
  pointer-events:auto; /* ensure buttons inside are clickable */
}
@keyframes floatCard{0%,100%{transform:translateY(0);}50%{transform:translateY(-5px);}}
input[type=number]{width:60px;margin:0 5px;}
button{
  margin-top:10px;
  padding:10px 15px;
  border-radius:30px;
  border:none;
  background:linear-gradient(45deg,#ff00cc,#3333ff);
  color:white;
  cursor:pointer;
  transition:.3s;
  box-shadow:0 0 20px rgba(255,0,255,0.7);
  pointer-events:auto;
}
button:hover{transform:scale(1.05);box-shadow:0 0 35px cyan;}
#progress{
  height:8px;
  background:#222;
  border-radius:10px;
  overflow:hidden;
  margin-top:5px;
  display:none;
  position:relative;
  z-index:2;
}
#bar{
  height:100%;
  width:0%;
  background:linear-gradient(90deg,cyan,magenta);
  animation:glow 1s infinite alternate;
}
@keyframes glow{from{filter:brightness(1);}to{filter:brightness(1.5);}}
</style>
</head>
<body>

<div id="app">
<h1>Ultimate MP4 → MP3 Converter (Free)</h1>
<div id="drop">Click or Drop MP4 Files</div>
<div id="fileList"></div>
<button id="convertBtn">Convert Selected Files</button>
<div id="progress"><div id="bar"></div></div>
</div>

<script src="https://cdn.jsdelivr.net/npm/@ffmpeg/ffmpeg@0.12.6/dist/ffmpeg.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/jszip@3.10.1/dist/jszip.min.js"></script>
<script>
const { createFFmpeg, fetchFile } = FFmpeg;
const ffmpeg = createFFmpeg({ log:true });

const drop = document.getElementById('drop');
const fileList = document.getElementById('fileList');
const convertBtn = document.getElementById('convertBtn');
const progress = document.getElementById('progress');
const bar = document.getElementById('bar');

let files = [];

// Drag & Click upload
drop.addEventListener('click', ()=>fileInput.click());
drop.addEventListener('dragover', e=>{ e.preventDefault(); drop.style.background="rgba(0,255,255,0.2)"; });
drop.addEventListener('dragleave', e=>{ e.preventDefault(); drop.style.background=""; });
drop.addEventListener('drop', e=>{ e.preventDefault(); addFiles(e.dataTransfer.files); drop.style.background=""; });

const fileInput = document.createElement('input');
fileInput.type='file';
fileInput.accept='video/mp4';
fileInput.multiple=true;
fileInput.style.display='none';
fileInput.addEventListener('change', e=>addFiles(e.target.files));
document.body.appendChild(fileInput);

function addFiles(selectedFiles){
  for(const f of selectedFiles){
    files.push({file:f,start:0,end:10});
  }
  renderFiles();
}

function renderFiles(){
  fileList.innerHTML='';
  files.forEach((f,i)=>{
    const div=document.createElement('div');
    div.className='file-card';
    div.innerHTML=`${f.file.name} <div>Start:<input type="number" min="0" value="${f.start}" id="start${i}"> End:<input type="number" min="1" value="${f.end}" id="end${i}"></div>`;
    fileList.appendChild(div);
  });
}

// Convert
convertBtn.addEventListener('click', async()=>{
  if(files.length==0){ alert("No files selected"); return; }

  progress.style.display="block"; bar.style.width='0%';

  if(!ffmpeg.isLoaded()) await ffmpeg.load();

  const zip = new JSZip();
  let total = files.length, done=0;

  for(let i=0;i<files.length;i++){
    const f=files[i];
    f.start = parseInt(document.getElementById('start'+i).value);
    f.end = parseInt(document.getElementById('end'+i).value);
    ffmpeg.FS('writeFile','input.mp4', await fetchFile(f.file));
    await ffmpeg.run('-i','input.mp4','-ss',`${f.start}`,'-to',`${f.end}`,'-q:a','0','output.mp3');
    const data = ffmpeg.FS('readFile','output.mp3');
    zip.file(f.file.name.replace('.mp4','.mp3'), data.buffer);
    done++;
    bar.style.width = `${Math.floor((done/total)*100)}%`;
  }

  const blob = await zip.generateAsync({type:'blob'});
  const url = URL.createObjectURL(blob);
  const a = document.createElement('a');
  a.href=url; a.download='Converted_MP3s.zip';
  a.click();

  progress.style.display="none";
});
</script>

</body>
</html>
